<!DOCTYPE html>
<html>

<head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script src="./index.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
        }
    </style>
</head>

<body>
<div id="map"></div>

<script>
    let map;

    /** An array of types google.maps.Marker, storing all markers to be displayed on the map. */
    let markers = [];

    /**
    * Creates the google.maps.Map to be rendered on the html map div element with optional Map options.
    * Map options activated are zoom, centre, and mapTypeControl.
    */
    function initMap() {
        const myLatLng = { lat: 41.763, lng: -87.644 };
        var myMapOptions = {
            zoom: 1,
            center: new google.maps.LatLng(myLatLng),
            mapTypeControl: false,
        }
        map = new google.maps.Map(document.getElementById("map"), myMapOptions);
    }

    /**
     * Creates a new google.maps.Marker object for the given recordId, sets its position, and displays it on the map.
     * @param recordId  The id of the CrimeRecord to which the added marker corresponds.
     * @param latitude  The latitudinal location at which the crime took place.
     * @param longitude The longitudinal location at which the crime took place.
     */
    function addMarker(recordId, latitude, longitude) {
        var marker = new google.maps.Marker({
            position: new google.maps.LatLng(latitude, longitude),
            crimeId: recordId
        });
        marker.setMap(map);

        markers.push(marker);
    }

    /**
     * Removes a marker corresponding to a specific CrimeRecord from the map.
     * @param recordId  The id of the CrimeRecord whose marker is to be removed.
     */
    function removeMarker(recordId) {
        for (let i = 0; i < markers.length; i++) {
            if (markers[i].recordId == recordId) {
                markers[i].setMap(null);
                delete markers[i];
                markers.splice(i, 1);
            }
        }
    }

    /**
     * Removes all markers from the map.
     */
    function clearMarkers() {
        for (let i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
            delete markers[i];
        }
        markers = [];
    }

    /**
    * Sets the boundary of the map to contain all the markers to be seen
    */
    function setBounds() {
        var bounds = new google.maps.LatLngBounds();

        for (let i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].position)
        }
        map.setCenter(bounds.getCenter());
        map.fitBounds(bounds);
    }
</script>

<!-- Async script executes immediately and must be after any DOM elements used in callback. -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAka2EHrmJfR-AU7CkIJFzplWzG2Z-x_qo&callback=initMap&libraries=&v=weekly" async></script>

</body>
</html>